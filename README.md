# Вопросы для викторины
Веб сервис **random_questions** предназначен для генерации англоязычных уникальных вопросов при получении POST-запроса.

В параметры POST-запроса передается количество вопросов для генерации:
`{"questions_num": integer}`

После получения запроса веб-сервис запрашивает с публичного API англоязычные вопросы для викторины, обращаясь по адресу https://jservice.io/api/random?count=questions_num
При этом в параметре запроса `count` указывается количество генерирующих вопросов `questions_num`


Полученные вопросы и ответы сохраняются в базе данных PostgreSQL. \
Структура базы данных, с которой работает веб сервис **random_questions**, представлена ниже:

![](./readme_images/db_scheme.png)

Ответом на POST-запрос со стороны веб-сервиса является предыдущий сохраненный вопрос, который хранится в базе данных:
```
    {"question": "What is the capital of Russia?"}
```

## Переменные окружения
Перед запуском веб-сервиса на host-системе убедитесь в наличии в
директории с проектом файла ".env", хранящего следующие настройки:

* **DB_HOST** = localhost
  > IP адрес, где расположена база данных
* **DB_PORT** = 5432
  > номер порта, по которому необходимо обращаться для подключения к БД
* **DB_USER** = ...
  > имя пользователя в PostgreSQL
* **DB_PASS** = ...
  > пароль для пользователя в PostgreSQL
* **DB_NAME** = victorina
  >  имя БД
* **URL** = https://jservice.io/api/random
  > адрес для генерации вопросов


## Установка и запуск приложения
Скопируйте репозиторий, используя следующую команду:

```
git clone https://github.com/YuryRass/random_questions.git
```

Затем установите необходимые зависимости из файла requirements.txt:

```
pip3 install -r requirements.txt
```

Создайте базу данных с соответсвующими таблицами, используя alembic:

```
alembic upgrade head
```

Для работы FastAPI используется веб-сервер `uvicorn`.
Запуск веб-сервера `uvicorn` осуществляется из корневой директории проекта:
```
uvicorn app.main:app --reload
```
По умолчанию веб-сервер запускается по адресу http://127.0.0.1:8000

Для отправки POST-запроса на веб-сервис **random_questions** используется команда `curl` (для ОС Linux)\
Пример отправки POST-запроса для генерации одного вопроса:
```
    curl -X 'POST' \
    'http://127.0.0.1:8000/victorina/question?questions_num=1' \
    -H 'accept: application/json' \
    -d ''
```
Также отправку POST-запроса возможно осуществить с помощью документации FastAPI, перейдя по адерсу http://127.0.0.1:8000/docs. Далее следует запустить end-point "Get random question" и передать любое натуральное значение параметру `questions_num`

![](./readme_images/POST-query.png)

### Dockerfile
Для запуска веб-сервера (FastAPI) внутри контейнера необходимо раскомментировать код внутри Dockerfile и иметь уже запущенный экземпляр PostgreSQL на компьютере.
Код для запуска приложения в docker-контейнере:
```
docker build -t <name_image>
docker run <name_image>
```
Команда также запускается из корневой директории, в которой лежит файл Dockerfile.

### Docker compose
Перед запуском двух сервисов PostgreSQL и FastAPI необходимо убедиться в наличии в корне проекта файла `.env-non-dev`

Также необходимо использовать файл `docker-compose.yaml` и команды
```
docker compose build
docker compose up
```
Причем `build` команду нужно запускать только в том случае, если в файл Dockerfile были внесены какие-либо изменения (то есть была изменена логика составления образа).